import{d as o,w as d}from"./BlaUjf9h.js";import{a as u}from"./BF9jo3u2.js";function c(){const{subscribe:i,set:s,update:n}=d({user:null,isLoading:!0,isLoggedIn:!1});return{subscribe:i,async init(){n(e=>({...e,isLoading:!0})),this.setUser()},async login(e,t){n(r=>({...r,isLoading:!0}));try{const r=await fetch(u("/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(r.ok)return s({user:null,isLoading:!1,isLoggedIn:!0}),{success:!0};{const l=await r.text();return s({user:null,isLoading:!1,isLoggedIn:!1}),{success:!1,error:l}}}catch(r){return console.error("Login failed:",r),s({user:null,isLoading:!1,isLoggedIn:!1}),{success:!1,error:"Network error"}}},async logout(){n(e=>({...e,isLoading:!0}));try{await fetch(u("/logout"),{method:"POST",credentials:"include"})}catch(e){console.error("Logout request failed:",e)}s({user:null,isLoading:!1,isLoggedIn:!1})},async setUser(){try{const e=await fetch(u("/profile"),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(e.ok){const t=await e.json();s({user:t,isLoading:!1,isLoggedIn:!0})}else s({user:null,isLoading:!1,isLoggedIn:!1})}catch(e){console.error("Failed to fetch profile:",e),s({user:null,isLoading:!1,isLoggedIn:!1})}},async refresh(){await this.init()},clear(){s({user:null,isLoading:!1,isLoggedIn:!1})},async requireAdmin(){var t,r;let e=this.getState();return e.isLoading&&(await this.init(),e=this.getState()),!e.isLoggedIn||!((r=(t=e.user)==null?void 0:t.roles)!=null&&r.some(l=>l.name==="Admin"))?(typeof window<"u"&&(window.location.href="/"),!1):!0},getState(){let e={user:null,isLoading:!0,isLoggedIn:!1};return this.subscribe(t=>e=t)(),e}}}const a=c(),L=o(a,i=>i.user),h=o(a,i=>i.isLoggedIn),p=o(a,i=>i.isLoading),m=o(a,i=>{var s,n;return((n=(s=i.user)==null?void 0:s.roles)==null?void 0:n.some(e=>e.name==="Admin"))??!1});export{a,m as b,h as c,p as i,L as u};
