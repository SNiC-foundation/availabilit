import{d as a,w as d}from"./B-wGjt8j.js";import{a as u}from"./JSKLHevw.js";function g(){const{subscribe:r,set:s,update:n}=d({user:null,isLoading:!0,isLoggedIn:!1});return{subscribe:r,async init(){n(e=>({...e,isLoading:!0})),await this.setUser()},async login(e,i){n(t=>({...t,isLoading:!0}));try{const t=await fetch(u("/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:i})});if(t.ok)return n(o=>({...o,isLoggedIn:!0,isLoading:!1})),console.debug("Logging in"),{success:!0};{const o=await t.text();return s({user:null,isLoading:!1,isLoggedIn:!1}),{success:!1,error:o}}}catch(t){return console.error("Login failed:",t),s({user:null,isLoading:!1,isLoggedIn:!1}),{success:!1,error:"Network error"}}},async logout(){n(e=>({...e,isLoading:!0}));try{await fetch(u("/logout"),{method:"POST",credentials:"include"})}catch(e){console.error("Logout request failed:",e)}s({user:null,isLoading:!1,isLoggedIn:!1})},async setUser(){console.debug("Setting user");try{const e=await fetch(u("/profile"),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(console.debug(e),e.ok){const i=await e.json();return s({user:i,isLoading:!1,isLoggedIn:!0}),!0}else return s({user:null,isLoading:!1,isLoggedIn:!1}),!1}catch(e){return console.error("Failed to fetch profile:",e),s({user:null,isLoading:!1,isLoggedIn:!1}),!1}},async refresh(){await this.init()},clear(){s({user:null,isLoading:!1,isLoggedIn:!1})},async requireAdmin(){var i,t;let e=this.getState();return e.isLoading&&(await this.init(),e=this.getState()),!e.isLoggedIn||!((t=(i=e.user)==null?void 0:i.roles)!=null&&t.some(o=>o.name==="Admin"))?(typeof window<"u"&&(window.location.href="/"),!1):!0},getState(){let e={user:null,isLoading:!0,isLoggedIn:!1};return this.subscribe(i=>e=i)(),e}}}const l=g(),L=a(l,r=>r.user),h=a(l,r=>r.isLoggedIn),m=a(l,r=>r.isLoading),p=a(l,r=>{var s,n;return((n=(s=r.user)==null?void 0:s.roles)==null?void 0:n.some(e=>e.name==="Admin"))??!1}),w=a(l,r=>{var s,n;return((n=(s=r.user)==null?void 0:s.roles)==null?void 0:n.some(e=>e.name==="Volunteer"))??!1});export{l as a,p as b,h as c,w as d,m as i,L as u};
